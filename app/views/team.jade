extends layout/hero-two-col

block profile
  div.profile-area.clearfix
    div.profile-img
      img(src= team.logo)
    div.profile-name-status
      h1 Team #{team.name} (#{members.length} Members)
      h3 Mentor:&nbsp;
        a(href= "/user/" + team.mentor.username)= team.mentor.username
      div.call-counters.clearfix
        div.call-count
          .hero= calls.monthlyCount
          div Calls Made
          div This month
          //- div since Jul 2015
        div#monthly-chart.call-chart

block information

  div.info-ranking.clearfix
    h4 Rankings
    div.personal-ranking
      a(href='/rank/team')
        span.label This Week
      span.rank!= team.weekly_ranking
    div.overall-ranking
      a(href='/rank/team')
        span.label Overall
      span.rank!= team.overall_ranking

  //team calls for the last 30 days
  div.last-30-days
    h4 This Week
    div.weekly-calls.clearfix
      h5
        div.hero= calls.weeklyCount
        div Calls Made
      div#weekly-calls

  //list of all members
  div.member-list-area
    h4 Members (#{members.length})
      ul.member-list
        each mem in members
          li.member-item
            a.member(href="/user/" + mem.username)
              img(src= mem.photo)
  //Join team
  div.join-team
    if user
      if !team || !team._id.equals(user.team)
        form(class='join-team', action='/team/join', method='POST')
          input(type='hidden', name='team[_id]', value= team._id)
          button.blue-button Join #{team.name}
      else
        form(class='join-team', action='/team/leave', method='POST')
          input(type='hidden', name='team[_id]', value= team._id)
          button.blue-button Leave #{team.name}

block activities
  if user && activities.length == 0 && user.team.equals(team._id)
    div.call-now.highlight
      h1 Make the first call for your team now!
        br
        br
        h3 <strong>Step 1</strong>:
          a(href='http://organize.berniesanders.com/', target='blank')&nbsp; Call using the official campaign's Ground Control app
        br
        h3 <strong>Step 2</strong>:
          a(href='https://docs.google.com/forms/d/15zawSuJwEOmeq1ULse6fOLDqK2LNTwBp2RibTfh17vU/viewform', target='blank')&nbsp; Report your calls/texts via Google Spreadsheet.
        br
        h5 All calls/texts you make will be added to your team's daily contacts.

  else
    ul.activity-list
      each activity in activities
        li.activity-item
          div.action-area.clearfix
            div.img-area(style="background-image: url(" + activity.icon + ")")
              a.fill-space
            div.act
              p.act-text
                a.act-actor(href= activity.source.url)= activity.source.label
                span.act-action= activity.action
                a.act-recipient(href= activity.target.url)= activity.target.label
                span.act-time-ago= activity.time_ago
              p.act-brand
                each user in activity.users_involved
                    a(href='/user/' + user.username)
                      img(src= user.photo, style='width: 30px; height: 30px;')

block more
  div.call-to-action
    a.cta.blue-button(href= team.fundraising_link, target='_blank', style='line-height: 1; font-size: 12px; margin-top: 30px;') Pledge to Sponsor <br/>Team #{team.name}
  //- div.badges
  //-   ul.badges-list
  //-     - for(var i = 0; i < 2; i ++) {

  //-       li.badge-item.clearfix
  //-         div.badge-img(style="background-image: url(/images/profile.jpg)")
  //-         div.badge-label
  //-           h4 Bernie Sanders Award for Best Caller
  //-           span.date-received Dec 1 2015
  //-     - }
block scripts
  script(src='/javascripts/d3.js', type='text/javascript')
  script(src='/javascripts/c3.js', type='text/javascript')
  script(type='text/javascript').
    window.weeklyData = !{calls.weekly};
    window.monthlyData = !{calls.monthly};
  script(type='text/javascript').
    window.pageFactory = (function(){
      // Arrange weekly data
      c3.generate({
        bindto: '#weekly-calls',
        data: {
          x: 'date',
          columns: [
            ['date'].concat(window.weeklyData.map(function(i){ return i._id})),
            ['calls'].concat(window.weeklyData.map(function(i){ return i.count}))
          ],
          type: 'bar'
        },
        legend:{ show: false },
        axis: {
          x: {
            type: 'timeseries',
            tick: {
              format: '%a'
            },
            //- show: false
          },
          y: { show: false }
        },
        bar: {
          width: 20
        }
      });

      //Weekly dAta
      c3.generate({
        bindto: '#monthly-chart',
        data: {
          x: 'date',
          columns: [
            ['date'].concat(window.monthlyData.map(function(i){ return i._id})),
            ['calls'].concat(window.monthlyData.map(function(i){ return i.count}))
          ],
          type: 'bar'
        },
        legend:{ show: false },
        axis: {
          x: {
            type: 'timeseries',
            //- tick: {
            //-   format: '%a'
            //- },
            //- show: false
          },
          y: { show: false }
        },
        bar: {
          width: 20
        }
      });


    })();
